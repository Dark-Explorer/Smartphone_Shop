<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">

<head>
    <title>NHD | Đăng ký</title>
    <div th:replace="~{user-fragment::head}"></div>
</head>

<body>
<div th:replace="~{user-fragment::header}"></div>

<div style="height: 100px"></div>
<!--================Register Box Area =================-->
<section class="login_box_area section_gap">
    <div class="container">
        <div class="row">
            <div class="col-lg-6">
                <div class="login_box_img">
                    <img class="img-fluid" th:src="@{img/login.jpg}" alt="">
                    <div class="hover">
                        <h4>Đã có tài khoản?</h4>
                        <a class="primary-btn" th:href="@{user-login}">Đăng nhập</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="login_form_inner">
                    <h3>Đăng ký tài khoản</h3>
                    <div th:if = "${success}">
                        <p class = "alert alert-success" th:text = "${success}"></p>
                    </div>
                    <div th:if = "${usernameError}">
                        <p class = "alert alert-danger" th:text = "${usernameError}"></p>
                    </div>
                    <div th:if = "${emailError}">
                        <p class = "alert alert-danger" th:text = "${emailError}"></p>
                    </div>
                    <div th:if = "${phoneError}">
                        <p class = "alert alert-danger" th:text = "${phoneError}"></p>
                    </div>
                    <div th:if = "${passwordError}">
                        <p class = "alert alert-danger" th:text = "${passwordError}"></p>
                    </div>
                    <form class="row login_form" th:action="@{/register-new}" th:object="${userDTO}" method="POST" id="contactForm" novalidate="novalidate">
                        <div class="col-md-12 form-group">
                            <input type="text" class="form-control" id="name" name="name" placeholder="Họ và tên" th:field="*{name}" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Họ và tên'" required>
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="text" class="form-control" id="phone" name="name" placeholder="Số điện thoại" th:field="*{phone}" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Số điện thoại'" required>
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="text" class="form-control" id="mail" name="name" placeholder="Email" th:field="*{email}" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Email'">
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="text" class="form-control" id="username" name="name" placeholder="Tên đăng nhập" th:field="*{username}" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Tên đăng nhập'">
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="password" class="form-control" id="password" name="name" placeholder="Mật khẩu (ít nhất 6 ký tự)" th:field="*{password}" pattern=".{6,}" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Mật khẩu'">
                        </div>
                        <div class="col-md-12 form-group">
                            <input type="password" class="form-control" id="repeat-password" name="name" placeholder="Nhập lại mật khẩu" th:field="*{repeatPassword}" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Nhập lại mật khẩu'">
                        </div>
                        <div class="col-md-12 form-group">
                            <button type="submit" class="primary-btn">ĐĂNG KÝ</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<!--================End Register Box Area =================-->

<div th:replace="~{user-fragment::footer}"></div>

<div th:replace="~{user-fragment::JS-import}"></div>
<script>
    function validatePhoneNumber(phoneNumber) {
        const phoneRegex = /^0\d{9}$/;
        return phoneRegex.test(phoneNumber);
    }

    // Validate email format
    function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    // Validate password length
    function validatePassword(password) {
        return password.length >= 6;
    }

    // Function to display error message
    function showError(inputElement, message) {
        let errorElement = inputElement.nextElementSibling;
        if (!errorElement || !errorElement.classList.contains('error-message')) {
            const newErrorElement = document.createElement('span');
            newErrorElement.classList.add('error-message');
            newErrorElement.style.color = 'red';
            inputElement.parentNode.insertBefore(newErrorElement, inputElement.nextSibling);
            errorElement = newErrorElement;
        }
        errorElement.textContent = message;
        inputElement.classList.add('is-invalid');
    }

    function clearError(inputElement) {
        const errorElement = inputElement.nextElementSibling;
        if (errorElement && errorElement.classList.contains('error-message')) {
            errorElement.textContent = '';
        }
        inputElement.classList.remove('is-invalid');
    }

    function validateName() {
        const nameInput = document.getElementById('name');
        if (!nameInput.value.trim()) {
            showError(nameInput, 'Họ và tên không được để trống');
            return false;
        }
        clearError(nameInput);
        return true;
    }

    function validatePhone() {
        const phoneInput = document.getElementById('phone');
        if (!validatePhoneNumber(phoneInput.value)) {
            showError(phoneInput, 'Số điện thoại không hợp lệ');
            return false;
        }
        clearError(phoneInput);
        return true;
    }

    function validateEmailInput() {
        const emailInput = document.getElementById('mail');
        if (!validateEmail(emailInput.value)) {
            showError(emailInput, 'Email không hợp lệ');
            return false;
        }
        clearError(emailInput);
        return true;
    }

    function validateUsername() {
        const usernameInput = document.getElementById('username');
        if (!usernameInput.value.trim()) {
            showError(usernameInput, 'Tên đăng nhập không được để trống');
            return false;
        }
        clearError(usernameInput);
        return true;
    }

    function validatePasswordInput() {
        const passwordInput = document.getElementById('password');
        if (!validatePassword(passwordInput.value)) {
            showError(passwordInput, 'Mật khẩu phải có ít nhất 6 ký tự');
            return false;
        }
        clearError(passwordInput);
        return true;
    }

    function validateRepeatPassword() {
        const passwordInput = document.getElementById('password');
        const repeatPasswordInput = document.getElementById('repeat-password');
        if (repeatPasswordInput.value !== passwordInput.value) {
            showError(repeatPasswordInput, 'Mật khẩu không khớp');
            return false;
        }
        clearError(repeatPasswordInput);
        return true;
    }

    document.getElementById('name').addEventListener('input', validateName);
    document.getElementById('phone').addEventListener('input', validatePhone);
    document.getElementById('mail').addEventListener('input', validateEmailInput);
    document.getElementById('username').addEventListener('input', validateUsername);
    document.getElementById('password').addEventListener('input', validatePasswordInput);
    document.getElementById('repeat-password').addEventListener('input', validateRepeatPassword);

    document.getElementById('contactForm').addEventListener('submit', function(event) {
        const isNameValid = validateName();
        const isPhoneValid = validatePhone();
        const isEmailValid = validateEmailInput();
        const isUsernameValid = validateUsername();
        const isPasswordValid = validatePasswordInput();
        const isRepeatPasswordValid = validateRepeatPassword();

        if (!isNameValid || !isPhoneValid || !isEmailValid || !isUsernameValid || !isPasswordValid || !isRepeatPasswordValid) {
            event.preventDefault();
        }
    });
</script>
</body>

</html>