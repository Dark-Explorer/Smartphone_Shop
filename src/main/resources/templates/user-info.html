<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">

<head>
    <title>NHD | Thông tin cá nhân</title>
    <div th:replace="~{user-fragment::head}"></div>
</head>

<body>

    <div th:replace="~{user-fragment::header}"></div>

    <!-- Start Banner Area -->
    <section class="banner-area organic-breadcrumb">
        <div class="container">
            <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
                <div class="col-first">
                    <h1>Thông tin cá nhân</h1>
                </div>
            </div>
        </div>
    </section>
    <!-- End Banner Area -->

    <!--================Blog Area =================-->
    <section class="blog_area single-post-area section_gap">
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="blog_right_sidebar">
                        <aside class="single_sidebar_widget author_widget">
                            <img class="author_img rounded-circle" src="/img/blog/avt.jpg" alt="" style="width: 70%">
                            <h4 th:text="${user.name}"></h4>
                            <p>Khách hàng</p>
                            <div class="br"></div>
                        </aside>
                    </div>
                </div>

                <div class="col-lg-9">
                    <section class="product_description_area" style="margin-top: 0">
                        <div class="container">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Thông tin khách hàng</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile"
                                       aria-selected="false">Chỉnh sửa thông tin</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact"
                                       aria-selected="false">Đơn hàng</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="password-tab" data-toggle="tab" href="#password-change" role="tab" aria-controls="contact"
                                       aria-selected="false">Đổi mật khẩu</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <tbody>
                                            <tr>
                                                <td>
                                                    <h5>Tên khách hàng</h5>
                                                </td>
                                                <td>
                                                    <h5 th:text="${user.name}"></h5>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <h5>SĐT</h5>
                                                </td>
                                                <td>
                                                    <h5 th:text="${user.phone}"></h5>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <h5>Địa chỉ</h5>
                                                </td>
                                                <td>
                                                    <h5 th:text="${user.address}"></h5>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <h5>Email</h5>
                                                </td>
                                                <td>
                                                    <h5 th:text="${user.email}"></h5>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <h5>Ngày đăng ký</h5>
                                                </td>
                                                <td>
                                                    <h5 th:text="${#temporals.format(user.date_signup, 'dd-MM-YYYY')}"></h5>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                    <div class="col-lg-12">
                                        <form class="row" th:action="@{/edit-info}" method="post">
                                            <div class="col-md-12 form-group">
                                                <label for="name">Tên</label>
                                                <input type="text" class="form-control" id="name" name="name" th:value="${user.name}" readonly>
                                            </div>
                                            <div class="col-md-12 form-group">
                                                <label for="phone">Số điện thoại</label>
                                                <input type="text" class="form-control" id="phone" name="phone" th:value="${user.phone}">
                                            </div>
                                            <div class="col-md-12 form-group">
                                                <label for="email">Email</label>
                                                <input type="text" class="form-control" id="email" name="email" th:value="${user.email}">
                                            </div>
                                            <div class="col-md-12 form-group">
                                                <label for="address">Địa chỉ</label>
                                                <input type="text" class="form-control" id="address" name="address" th:value="${user.address}">
                                            </div>
                                            <div class="col-md-12 text-right">
                                                <button type="submit" value="submit" class="btn primary-btn">Xác nhận</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                                    <div th:if = "${success}" class = "text-center alert alert-success" style="height: 4rem;">
                                        <a th:text = "${success}"></a>
                                    </div>
                                    <div th:if = "${error}" class="text-center alert alert-danger">
                                        <a th:text = "${error}"></a>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Đặt hàng</th>
                                                    <th>Thành tiền</th>
                                                    <th>Sản phẩm</th>
                                                    <th>Trạng thái</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr th:each="i : ${#numbers.sequence(user.orders.size() - 1, 0, -1)}">
                                                    <td style="padding: 14px 12px">
                                                        <p th:text="${#temporals.format(user.orders[i].date_created, 'yyyy-MM-dd HH:mm')}"></p>
                                                    </td>
                                                    <td style="padding: 14px 12px">
                                                        <p th:text="${#numbers.formatDecimal(user.orders[i].total, 0, 'COMMA', 3, 'POINT').replace('.000', '') + '&#8363;'}"></p>
                                                    </td>
                                                    <td style="padding: 14px 12px">
                                                        <div th:each="product : ${user.orders[i].orderLines}">
                                                            <p th:text="${product.qty} + ' x ' + ${product.productItem.product.name} + ' (' + ${product.productItem.variation} + ')'"></p>
                                                        </div>
                                                    </td>
                                                    <td style="padding: 14px 12px">
                                                        <p th:text="${user.orders[i].status}"></p>
                                                        <p style="color: green" th:text="${#temporals.format(user.orders[i].date_updated, 'yyyy-MM-dd HH:mm')}"></p>
                                                        <a id="delete" th:onclick="'confirmDelete(' + ${user.orders[i].id} + ')'" th:if="${user.orders[i].status == T(com.ecommerce.smartphoneshop.domain.OrderStatus).CREATED}"
                                                           class="genric-btn danger" style="padding: 0.3em; font-size: 1em; line-height: 1.5em">Hủy đơn</a>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="password-change" role="tabpanel" aria-labelledby="profile-tab">
                                    <div id="successMessage" th:if = "${success}" class = "text-center alert alert-success" style="height: 4rem;">
                                        <a th:text = "${success}"></a>
                                    </div>
                                    <div id="errorMessage" th:if = "${error}" class="text-center alert alert-danger">
                                        <a th:text = "${error}"></a>
                                    </div>
                                    <div class="col-lg-12">
                                        <form class="row" th:action="@{/update-password}" method="post">
                                            <div class="col-md-12 form-group">
                                                <label for="oldPassword">Mật khẩu cũ</label>
                                                <input type="password" class="form-control" id="oldPassword" name="oldPassword">
                                            </div>
                                            <div class="col-md-12 form-group">
                                                <label for="newPassword">Mật khẩu mới</label>
                                                <input type="password" class="form-control" id="newPassword" name="newPassword">
                                            </div>
                                            <div class="col-md-12 form-group">
                                                <label for="confirmPassword">Xác nhận mật khẩu</label>
                                                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword">
                                            </div>
                                            <div class="col-md-12 text-right">
                                                <button type="submit" value="submit" class="btn primary-btn">Xác nhận</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </section>
    <!--================Blog Area =================-->

    <div th:replace="~{user-fragment::footer}"></div>

    <div th:replace="~{user-fragment::JS-import}"></div>

    <script>
        function confirmDelete(orderID) {
            if (confirm('Bạn có chắc chắn muốn hủy đơn hàng này?')) {
                fetch(`/user-cancel-order/${orderID}`, {
                    method: 'POST',
                })
                    .then(response => response.text())
                    .then(data => {
                        alert('Hủy đơn hàng thành công!');
                        location.reload();
                    })
                    .catch((error) => {
                        alert('Có lỗi xảy ra!');
                    });
            }
        }
    </script>
</body>

</html>